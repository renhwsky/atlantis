---
layout: post
title:  快照技术
date: 2020-03-05
categories: 分布式系统 快照 snap
tags: 快照
excerpt: ceph snap
---

快照的2种技术
---

快照主要有2种技术
COW（Copy on Frist Write）和ROW（Redirect on Frist Write）


COW技术
---
写时拷贝，是指在快照的基数上，有新的写入或者删除操作，导致快照部分的数据有变化时，会做如下动作：
(1) 申请新空间
(2) 读取待修改的空间数据
(3) 将待修改部分的数据拷贝到这个空间中
(4) 更新快照指向这个新的空间
(5) 修改原数据空间内容

ROW技术
---
写时重定向，是指在快照的基础上，有新的写入或者删除操作，导致快照部分的数据有变化时，会做如下动作：
（1）申请新的空间
（4）写入或者更新新空间的数据(修改操作提前在内存中有原始数据的全部部分,所以不需要拷贝)
（5）更新原始卷指向新的空间


COW技术与ROW技术优缺点比较
| 类型 | 优点 | 缺点 |
| --- | --- | --- |
|COW|原始卷数据连续性好，没有碎片化|1次读3次写，写放大严重 |
|ROW|性能比COW好，只有2次写       |碎片化严重|


一致性快照
---
一致性快照，是指在多个卷之间进行同步快照，保证上层业务在使用多个卷时，也能实现快照和快照恢复功能
